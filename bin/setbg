#!/usr/bin/env nu

def "main" [image?: string]: nothing -> nothing {
  let file = $env.HOME | path join Pictures background.png

  if (if $image != null {
    let size = niri msg outputs
    | parse -r '^    (\d+x\d+)@\d+\.\d+ \(current\)'
    | get capture0.0

    magick $image -scale $size $file
    true
  } else { $file | path exists }) {
    do -i { pkill -x swaybg }
    swaybg -i ~/Pictures/background.png
  }
}
